<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Juego de Ahorcado Mejorado en la Farmacia</title>
  <style>
    /* BASIC STYLING */
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
    }
    .dark-mode {
      background-color: #333;
      color: #eee;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .game-area, .records-area {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      transition: background-color 0.3s, color 0.3s;
    }
    .dark-mode .game-area, .dark-mode .records-area {
      background-color: #555;
      color: #eee;
    }
    .game-area {
      flex: 2 1 600px;
    }
    .records-area {
      flex: 1 1 300px;
    }
    .game-area h1, .records-area h2 {
      text-align: center;
    }
    .word {
      font-size: 28px;
      letter-spacing: 5px;
      text-align: center;
      margin: 20px 0;
    }
    .image {
      text-align: center;
      margin: 20px 0;
    }
    #hangmanImage {
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    #message, #timerDisplay {
      font-size: 20px;
      text-align: center;
      margin: 10px 0;
      transition: opacity 0.5s;
    }
    .scoreboard, .current-score, .hint {
      text-align: center;
      margin: 10px 0;
      font-size: 18px;
    }
    /* Wrong Letters Table */
    .wrong-letters {
      text-align: center;
      margin-top: 20px;
    }
    .wrong-letters table {
      margin: 0 auto;
      border-collapse: collapse;
    }
    .wrong-letters th,
    .wrong-letters td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      text-transform: uppercase;
    }
    /* ON-SCREEN KEYBOARD */
    #keyboardContainer {
      text-align: center;
      margin-top: 15px;
    }
    #keyboardContainer button {
      margin: 4px;
      padding: 10px 14px;
      font-size: 16px;
      cursor: pointer;
      border: 1px solid #aaa;
      border-radius: 4px;
      text-transform: uppercase;
      width: 40px;
    }
    #keyboardContainer button:disabled {
      background-color: #ddd;
      color: #777;
      cursor: not-allowed;
    }
    .dark-mode #keyboardContainer button:disabled {
      background-color: #888;
      color: #444;
    }
    /* Modal Start Screen */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      text-align: center;
    }
    .modal-content input[type="text"],
    .modal-content select {
      width: 90%;
      padding: 8px;
      margin: 10px 0;
      font-size: 16px;
    }
    .modal-content button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    /* Records Table */
    .records-area table {
      width: 100%;
      margin-top: 10px;
      border-collapse: collapse;
    }
    .records-area th,
    .records-area td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    /* Animations */
    .animate-fadein {
      animation: fadeIn 0.5s;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    /* Dark Mode Toggle Button */
    #darkModeToggle {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 8px 12px;
      font-size: 14px;
      z-index: 1100;
    }
  </style>
</head>
<body>
  <!-- Botón para Dark/Light mode -->
  <button id="darkModeToggle" onclick="toggleDarkMode()">Toggle Dark Mode</button>
  
  <!-- Modal de inicio -->
  <div id="startModal" class="modal">
    <div class="modal-content">
      <h2>Bienvenido al Ahorcado en la Farmacia</h2>
      <form id="startForm">
        <div>
          <label>Modo de Juego:</label><br>
          <input type="radio" name="mode" value="singleplayer" checked> Solitario
          <input type="radio" name="mode" value="multiplayer"> Multijugador
        </div>
        <div id="multiplayerFields" style="display:none;">
          <label>Palabra Oculta:</label><br>
          <input type="text" id="multiplayerWord" maxlength="20"><br>
          <label>Pista:</label><br>
          <input type="text" id="multiplayerHint">
        </div>
        <div>
          <label>Dificultad:</label><br>
          <select id="difficultySelect">
            <option value="facil">Fácil</option>
            <option value="medio">Medio</option>
            <option value="dificil">Difícil</option>
          </select>
        </div>
        <br>
        <button type="submit">Comenzar Juego</button>
      </form>
    </div>
  </div>
  
  <!-- Contenedor principal (se muestra al iniciar el juego) -->
  <div class="container" id="gameContainer" style="display:none;">
    <!-- Área de Juego -->
    <div class="game-area">
      <h1>Juego de Ahorcado en la Farmacia</h1>
      <div class="image">
        <img id="hangmanImage" src="images/stage0.png" alt="Ahorcado" width="200" />
      </div>
      <div class="word" id="wordDisplay"></div>
      <div id="timerDisplay">Tiempo restante: <span id="timeLeft"></span> s</div>
      <!-- Teclado en pantalla -->
      <div id="keyboardContainer"></div>
      <div class="wrong-letters">
        <h2>Letras Incorrectas</h2>
        <table id="wrongLettersTable">
          <tr><th>Letras</th></tr>
        </table>
      </div>
      <div class="scoreboard">
        <p id="scoreBoard">Victorias: 0 | Derrotas: 0</p>
      </div>
      <div style="text-align: center;">
        <button onclick="game.resetGame()">Reiniciar Partida</button>
      </div>
      <p id="message"></p>
      <div class="current-score" id="currentScoreDisplay"></div>
      <div class="hint" id="hintDisplay"></div>
    </div>
    
    <!-- Área de Récords y Estadísticas -->
    <div class="records-area">
      <h2>Récords</h2>
      <div style="text-align:center;">
        <input id="recordName" type="text" placeholder="Tu Nombre">
        <button onclick="saveRecord()">Guardar Récord</button>
      </div>
      <table id="recordsTable">
        <tr>
          <th>Nombre</th>
          <th>Puntaje</th>
          <th>Fecha</th>
        </tr>
      </table>
      <div id="statsDisplay" style="margin-top:20px;">
        <h3>Estadísticas</h3>
        <p id="overallStats">Total Partidas: 0 | Victorias: 0 | Derrotas: 0 | Tiempo Promedio: 0 s</p>
      </div>
    </div>
  </div>
  
  <!-- Elementos de audio (asegúrate de contar con los archivos o ajusta las rutas) -->
  <audio id="audio-correct" src="sounds/correct.mp3"></audio>
  <audio id="audio-wrong" src="sounds/wrong.mp3"></audio>
  <audio id="audio-gameover" src="sounds/gameover.mp3"></audio>
  
  <script>
    /* Estadísticas globales */
    let totalGames = 0;
    let totalWins = 0;
    let totalLosses = 0;
    let totalTimeSpent = 0; // en segundos

    /* Alternar Dark/Light mode */
    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }
    
    /* Gestión de récords (almacenados en localStorage) */
    function loadRecords() {
      const recordsData = localStorage.getItem("hangmanRecords");
      return recordsData ? JSON.parse(recordsData) : [];
    }
    
    function saveRecords(records) {
      localStorage.setItem("hangmanRecords", JSON.stringify(records));
    }
    
    function updateRecordsTable() {
      const records = loadRecords();
      const table = document.getElementById("recordsTable");
      let rows = "<tr><th>Nombre</th><th>Puntaje</th><th>Fecha</th></tr>";
      records.forEach(record => {
        rows += `<tr><td>${record.name}</td><td>${record.score}</td><td>${record.date}</td></tr>`;
      });
      table.innerHTML = rows;
    }
    
    function saveRecord() {
      const nameInput = document.getElementById("recordName");
      const name = nameInput.value.trim();
      if (!name) {
        alert("Por favor, ingresa un nombre válido.");
        return;
      }
      const score = game.currentScore || 0;
      const record = {
        name: name,
        score: score,
        date: new Date().toLocaleString()
      };
      const records = loadRecords();
      records.push(record);
      records.sort((a, b) => b.score - a.score);
      saveRecords(records);
      updateRecordsTable();
      nameInput.value = "";
    }
    
    function updateStatsDisplay() {
      const avgTime = totalGames > 0 ? (totalTimeSpent / totalGames).toFixed(1) : 0;
      document.getElementById("overallStats").textContent = 
        `Total Partidas: ${totalGames} | Victorias: ${totalWins} | Derrotas: ${totalLosses} | Tiempo Promedio: ${avgTime} s`;
    }
    
    /* Teclado en pantalla (alfabeto: a-z, ñ) */
    const alphabet = ["a","b","c","d","e","f","g","h","i","j","k","l","m","n","ñ","o","p","q","r","s","t","u","v","w","x","y","z"];
    
    function buildKeyboard() {
      const container = document.getElementById("keyboardContainer");
      container.innerHTML = "";
      alphabet.forEach(letter => {
        const btn = document.createElement("button");
        btn.textContent = letter;
        btn.id = "key_" + letter;
        btn.addEventListener("click", () => {
          game.submitGuess(letter);
        });
        container.appendChild(btn);
      });
    }
    
    function resetKeyboard() {
      alphabet.forEach(letter => {
        const btn = document.getElementById("key_" + letter);
        if (btn) btn.disabled = false;
      });
    }
    
    /* Clase que contiene la lógica del juego con mejoras */
    class HangmanGame {
      constructor(options) {
        this.mode = options.mode; // "singleplayer" o "multiplayer"
        this.difficulty = options.difficulty; // "facil", "medio", "dificil"
        this.customWord = options.customWord || "";
        this.customHint = options.customHint || "";
        // Parámetros según la dificultad:
        switch(this.difficulty) {
          case "facil":
            this.maxAttempts = 8;
            this.turnTime = 15;
            this.alwaysShowHint = true;
            break;
          case "medio":
            this.maxAttempts = 6;
            this.turnTime = 10;
            this.alwaysShowHint = false;
            break;
          case "dificil":
            this.maxAttempts = 4;
            this.turnTime = 7;
            this.alwaysShowHint = false;
            break;
          default:
            this.maxAttempts = 6;
            this.turnTime = 10;
            this.alwaysShowHint = false;
        }
        // Lista de medicamentos para el modo solitario (total 20), productos vendidos en Venezuela
        this.words = [
          "atamel",
          "longacef",
          "miovit",
          "colypan",
          "aciclovir",
          "alpram",
          "levotiroxina",
          "candesartan",
          "propofol",
          "prurica",
          "paracetamol",
          "ibuprofeno",
          "amoxicilina",
          "omeprazol",
          "dipirona",
          "metformina",
          "captopril",
          "simvastatina",
          "loratadina",
          "azitromicina"
        ];
        this.hints = {
          "atamel": "Se usa para aliviar dolores leves a moderados.",
          "longacef": "Antibiótico para infecciones respiratorias.",
          "miovit": "Suplemento vitamínico para el organismo.",
          "colypan": "Se usa para tratar la hipertensión.",
          "aciclovir": "Combate infecciones por el virus del herpes.",
          "alpram": "Tratamiento para crisis de ansiedad y epilepsia.",
          "levotiroxina": "Esencial para tratar el hipotiroidismo.",
          "candesartan": "Controla la presión arterial alta.",
          "propofol": "Anestésico para procedimientos médicos.",
          "prurica": "Alivia el prurito en afecciones cutáneas.",
          "paracetamol": "Alivia el dolor y reduce la fiebre.",
          "ibuprofeno": "Antiinflamatorio y analgésico; reduce dolor e inflamación.",
          "amoxicilina": "Antibiótico para tratar diversas infecciones bacterianas.",
          "omeprazol": "Reduce la acidez estomacal y trata úlceras.",
          "dipirona": "Analgésico y antipirético para fiebre y dolor.",
          "metformina": "Medicamento de primera línea para la diabetes tipo 2.",
          "captopril": "Reduce la presión arterial al inhibir la ACE.",
          "simvastatina": "Disminuye el colesterol en la sangre.",
          "loratadina": "Antihistamínico eficaz contra alergias.",
          "azitromicina": "Antibiótico macrólido para infecciones respiratorias."
        };
        // Para modo solitario, evitar repetir palabras en cada ronda.
        this.availableWords = [...this.words];
        this.wins = 0;
        this.losses = 0;
        this.resetGame();
        this.updateScoreBoard();
      }
      
      resetGame() {
        this.stopTurnTimer();
        if (this.mode === "singleplayer") {
          if (this.availableWords.length === 0) {
            this.availableWords = [...this.words];
            alert("Has completado todas las palabras de esta ronda. Reiniciando la lista.");
          }
          let idx = Math.floor(Math.random() * this.availableWords.length);
          this.word = this.availableWords[idx];
          this.availableWords.splice(idx, 1);
          this.currentHint = this.hints[this.word];
        } else {
          this.word = this.customWord.toLowerCase();
          this.currentHint = this.customHint;
        }
        this.attempts = 0;
        this.guessedWord = Array(this.word.length).fill("_");
        this.wrongLetters = [];
        this.hintShown = false;
        this.currentScore = 0;
        this.startTime = new Date();
        
        this.updateWordDisplay();
        this.updateWrongLettersTable();
        this.updateHangmanImage();
        this.setMessage("");
        document.getElementById("currentScoreDisplay").textContent = "";
        document.getElementById("hintDisplay").textContent = this.alwaysShowHint ? this.currentHint : "";
        resetKeyboard();
        this.startTurnTimer();
      }
      
      updateWordDisplay() {
        const wordDisplay = document.getElementById("wordDisplay");
        wordDisplay.textContent = this.guessedWord.join(" ");
        wordDisplay.classList.add("animate-fadein");
        setTimeout(() => { wordDisplay.classList.remove("animate-fadein"); }, 500);
      }
      
      updateWrongLettersTable() {
        const table = document.getElementById("wrongLettersTable");
        let rowContent = "<tr><th>Letras</th></tr><tr>" +
          this.wrongLetters.map(letter => `<td>${letter}</td>`).join("") +
          "</tr>";
        table.innerHTML = rowContent;
        table.classList.add("animate-fadein");
        setTimeout(() => { table.classList.remove("animate-fadein"); }, 500);
      }
      
      setMessage(msg) {
        const messageEl = document.getElementById("message");
        messageEl.textContent = msg;
        messageEl.classList.add("animate-fadein");
        setTimeout(() => { messageEl.classList.remove("animate-fadein"); }, 500);
      }
      
      updateHangmanImage() {
        const hangmanImage = document.getElementById("hangmanImage");
        hangmanImage.src = `images/stage${this.attempts}.png`;
        hangmanImage.classList.add("animate-fadein");
        setTimeout(() => { hangmanImage.classList.remove("animate-fadein"); }, 500);
      }
      
      calculateScore() {
        if (!this.guessedWord.includes("_")) {
          return (this.maxAttempts - this.attempts) * 10;
        }
        return 0;
      }
      
      submitGuess(letter) {
        if (this.attempts >= this.maxAttempts || !this.guessedWord.includes("_")) return;
        if (this.guessedWord.includes(letter) || this.wrongLetters.includes(letter)) {
          this.setMessage("Ya has ingresado esa letra.");
          return;
        }
        this.stopTurnTimer();
        if (this.word.includes(letter)) {
          this.word.split("").forEach((char, index) => {
            if (char === letter) {
              this.guessedWord[index] = letter;
            }
          });
          this.updateWordDisplay();
          document.getElementById("audio-correct").play();
          if (!this.guessedWord.includes("_")) {
            this.currentScore = this.calculateScore();
            this.setMessage(`¡Felicidades! Ganaste. Puntaje: ${this.currentScore}`);
            document.getElementById("hangmanImage").src = "images/stage7.png";
            if (this.wrongLetters.length === 0) {
              this.setMessage("¡Juego perfecto! " + `Puntaje: ${this.currentScore}`);
            }
            this.wins++;
            this.updateScoreBoard();
            document.getElementById("currentScoreDisplay").textContent = `Puntaje obtenido: ${this.currentScore}`;
            this.stopTurnTimer();
            this.endGame();
            return;
          }
        } else {
          this.wrongLetters.push(letter);
          this.updateWrongLettersTable();
          this.attempts++;
          this.updateHangmanImage();
          document.getElementById("audio-wrong").play();
          if (!this.alwaysShowHint && !this.hintShown && this.attempts >= 3 && this.mode === "singleplayer") {
            document.getElementById("hintDisplay").textContent = this.currentHint;
            this.hintShown = true;
          }
          if (this.attempts === this.maxAttempts) {
            this.currentScore = 0;
            this.setMessage(`¡Game Over! La palabra era "${this.word}". Puntaje: ${this.currentScore}`);
            document.getElementById("hangmanImage").src = "images/stage" + this.maxAttempts + ".png";
            this.losses++;
            this.updateScoreBoard();
            document.getElementById("currentScoreDisplay").textContent = `Puntaje obtenido: ${this.currentScore}`;
            document.getElementById("audio-gameover").play();
            this.stopTurnTimer();
            this.endGame();
            return;
          }
        }
        this.startTurnTimer();
      }
      
      updateScoreBoard() {
        const scoreBoard = document.getElementById("scoreBoard");
        scoreBoard.textContent = `Victorias: ${this.wins} | Derrotas: ${this.losses}`;
        scoreBoard.classList.add("animate-fadein");
        setTimeout(() => { scoreBoard.classList.remove("animate-fadein"); }, 500);
      }
      
      /* Temporizador para cada turno */
      startTurnTimer() {
        this.remainingTime = this.turnTime;
        document.getElementById("timeLeft").textContent = this.remainingTime;
        this.timerInterval = setInterval(() => {
          this.remainingTime--;
          document.getElementById("timeLeft").textContent = this.remainingTime;
          if (this.remainingTime <= 0) {
            clearInterval(this.timerInterval);
            this.setMessage("¡Tiempo agotado! Se cuenta como error.");
            let dummy = "z";
            if (this.word.includes(dummy) || this.wrongLetters.includes(dummy)) {
              for (let l of alphabet) {
                if (!this.guessedWord.includes(l) && !this.wrongLetters.includes(l)) {
                  dummy = l;
                  break;
                }
              }
            }
            this.submitGuess(dummy);
          }
        }, 1000);
      }
      
      stopTurnTimer() {
        clearInterval(this.timerInterval);
      }
      
      endGame() {
        let endTime = new Date();
        let gameDuration = Math.floor((endTime - this.startTime) / 1000);
        totalGames++;
        if (this.currentScore > 0) {
          totalWins++;
        } else {
          totalLosses++;
        }
        totalTimeSpent += gameDuration;
        updateStatsDisplay();
      }
    }
    
    let game;
    
    /* Gestión del formulario de inicio */
    document.getElementById("startForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const mode = document.querySelector('input[name="mode"]:checked').value;
      const difficulty = document.getElementById("difficultySelect").value;
      let customWord = "";
      let customHint = "";
      if (mode === "multiplayer") {
        customWord = document.getElementById("multiplayerWord").value.trim();
        customHint = document.getElementById("multiplayerHint").value.trim();
        if (!customWord || !customHint) {
          alert("Por favor, ingresa tanto la palabra como la pista para el modo multijugador.");
          return;
        }
      }
      document.getElementById("startModal").style.display = "none";
      document.getElementById("gameContainer").style.display = "flex";
      buildKeyboard();
      game = new HangmanGame({
        mode: mode,
        difficulty: difficulty,
        customWord: customWord,
        customHint: customHint
      });
    });
    
    /* Mostrar/ocultar campos para multijugador */
    const modeRadios = document.querySelectorAll('input[name="mode"]');
    modeRadios.forEach(radio => {
      radio.addEventListener("change", function() {
        if (this.value === "multiplayer") {
          document.getElementById("multiplayerFields").style.display = "block";
        } else {
          document.getElementById("multiplayerFields").style.display = "none";
        }
      });
    });
    
    /* Soporte para teclado físico */
    document.addEventListener("keydown", function(e) {
      const letter = e.key.toLowerCase();
      if (alphabet.includes(letter)) {
        const btn = document.getElementById("key_" + letter);
        if (btn && !btn.disabled) {
          btn.disabled = true;
          if (game) {
            game.submitGuess(letter);
          }
        }
      }
    });
  </script>
</body>
</html>
